{% extends 'base.html' %}
{% block content %}
<main style="min-height: 57em;">
  <div class="container my-4">
    <h1 class="mb-3">Lista de Assistidos</h1>

    <a href="" class="btn btn-primary me-2">
      <i class="bi bi-pencil pe-2"></i>Cadastrar Assistido
    </a>
    <a href="" class="btn btn-outline-danger">
      <i class="bi bi-trash pe-2"></i>Arquivo Morto
    </a>
    <hr>

    <!-- Pesquisa -->
    <form method="get" class="mb-3">
      <div class="input-group">
        <input type="text" class="form-control" name="q" value="{{ request.GET.q|default:'' }}" placeholder="Pesquisar assistido...">
        <button class="btn btn-outline-secondary" type="submit">Pesquisar</button>
      </div>
    </form>

    <!-- Listagem -->
    <div class="accordion" id="assistidosAccordion">
      {% for a in assistidos %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ a.id_assist }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapse{{ a.id_assist }}" aria-expanded="false" aria-controls="collapse{{ a.id_assist }}">
            <i class="bi bi-person-circle me-2"></i>
            {{ a.nmcompleto_assist }} - <small class="text-muted ms-2">{{ a.numero_assist }}/{{ a.DTCADASTRO|date:'y' }}</small>
          </button>
        </h2>
        <div id="collapse{{ a.id_assist }}" class="accordion-collapse collapse" aria-labelledby="heading{{ a.id_assist }}"
          data-bs-parent="#assistidosAccordion">
          <div class="accordion-body">
            <div class="row">
              <div class="col-md-7">
                <p><strong>Data de Nascimento:</strong> {{ a.dn_assist|date:'d/m/Y' }}</p>
                <p><strong>Endereço:</strong> {{ a.rua_assist }}{% if a.numerocasa_assist %}, {{ a.numerocasa_assist }}{% endif %}</p>
                <p><strong>Bairro:</strong> {{ a.bairro_assist }}</p>
                <p><strong>Cidade:</strong> {{ a.cidade_assist }}</p>
                <p><strong>Responsável:</strong> {{ a.nmresponsavel_assist }}{% if a.nmresponsavel_assist == 'outro' and a.outro_responsavel %} - {{ a.outro_responsavel }}{% endif %}</p>
                <p><strong>Genitor:</strong> {{ a.nmgenitor_assist }}</p>
                <p><strong>Genitora:</strong> {{ a.nmgenitora_assist }}</p>
                <p><strong>Escola:</strong> {{ a.escola_assist }}</p>
                <p><strong>Gestante:</strong> {{ a.gestante_assist|yesno:'Sim,Não' }}</p>
              </div>
              <div class="col-md-5 border-start">
                <button class="btn btn-sm btn-outline-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#editForm{{ a.id_assist }}" aria-expanded="false" aria-controls="editForm{{ a.id_assist }}">
                  <i class="bi bi-pencil"></i> Editar
                </button>
                <div class="collapse" id="editForm{{ a.id_assist }}">
                  <form method="post" action="{% url 'assistido:editar' a.id_assist %}">
                    {% csrf_token %}
                    <div class="mb-2">
                      <label class="form-label">Nome completo</label>
                      <input type="text" class="form-control form-control-sm" name="nmcompleto_assist" value="{{ a.nmcompleto_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Número</label>
                      <input type="text" class="form-control form-control-sm" name="numero_assist" value="{{ a.numero_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Data de Nascimento</label>
                      <input type="date" class="form-control form-control-sm" name="dn_assist" value="{{ a.dn_assist|date:'Y-m-d' }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Endereço</label>
                      <input type="text" class="form-control form-control-sm" name="rua_assist" value="{{ a.rua_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Nº Casa</label>
                      <input type="text" class="form-control form-control-sm" name="numerocasa_assist" value="{{ a.numerocasa_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Bairro</label>
                      <input type="text" class="form-control form-control-sm" name="bairro_assist" value="{{ a.bairro_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Cidade</label>
                      <input type="text" class="form-control form-control-sm" name="cidade_assist" value="{{ a.cidade_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Responsável</label>
                      <input type="text" class="form-control form-control-sm" name="nmresponsavel_assist" value="{{ a.nmresponsavel_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Outro Responsável</label>
                      <input type="text" class="form-control form-control-sm" name="outro_responsavel" value="{{ a.outro_responsavel }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Genitor</label>
                      <input type="text" class="form-control form-control-sm" name="nmgenitor_assist" value="{{ a.nmgenitor_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Genitora</label>
                      <input type="text" class="form-control form-control-sm" name="nmgenitora_assist" value="{{ a.nmgenitora_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Escola</label>
                      <input type="text" class="form-control form-control-sm" name="escola_assist" value="{{ a.escola_assist }}">
                    </div>
                    <div class="mb-2">
                      <label class="form-label">Gestante</label>
                      <select class="form-select form-select-sm" name="gestante_assist">
                        <option value="True" {% if a.gestante_assist %}selected{% endif %}>Sim</option>
                        <option value="False" {% if not a.gestante_assist %}selected{% endif %}>Não</option>
                      </select>
                    </div>
                    <button type="submit" class="btn btn-success btn-sm">Salvar</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <p class="text-muted">Nenhum assistido encontrado.</p>
      {% endfor %}
    </div>
  </div>
</main>
{% endblock %}
